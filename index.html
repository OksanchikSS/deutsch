<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Проверка немецкой грамматики — зелёный/красный</title>
  <style>
    body {
      font-family: Arial, Helvetica, sans-serif;
      background: #f8f8f8;
      color: #333;
      margin: 0;
      padding: 40px;
      line-height: 1.6;
    }
    h1, h2 {
      color: #006600;
      text-align: center;
    }
    .exercise {
      max-width: 900px;
      margin: 30px auto;
      background: #fff;
      padding: 25px;
      border: 1px solid #ddd;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .sentence {
      margin: 15px 0;
      font-size: 1.3rem;
    }
    .gap {
      display: inline-block;
      min-width: 60px;
      padding: 2px 6px;
      border-bottom: 2px dashed #888;
      background: #f0f0f0;
      margin: 0 4px;
      font-family: monospace;
    }
    .correct { background: #ccffcc; color: #006600; border-bottom-color: #006600; }
    .wrong { background: #ffcccc; color: #cc0000; border-bottom-color: #cc0000; }
    .current { background: #ffff99; border-bottom: 3px solid #ffcc00; }
    .input-field {
      font-size: 1.2rem;
      padding: 12px;
      border: 2px solid #ccc;
      border-radius: 6px;
      width: 100%;
      margin-top: 20px;
      box-sizing: border-box;
    }
    .input-field:focus {
      border-color: #006600;
      outline: none;
    }
    .info {
      text-align: center;
      color: #666;
      font-size: 1.1rem;
    }
  </style>
</head>
<body>

<div class="exercise">
  <h1>Пиши правильно — зелёным, ошибки — красным</h1>
  
  <h2>1. Ergänzen Sie bitte zu:</h2>
  <div id="text1"></div>

  <h2>2. Ergänzen Sie die Fragen:</h2>
  <div id="text2"></div>

  <textarea id="input" class="input-field" rows="4" autofocus placeholder="Начинай печатать здесь..."></textarea>

  <div class="info">
    Просто набирай текст подряд — буквы/слова будут подсвечиваться автоматически.
  </div>
</div>

<script>
// Текст упражнения из твоего PDF (с пропусками как специальные маркеры)
const exerciseText = [
  // Часть 1
  "1. Meine Chefin engagiert sich dafür, dass ich ihnen bei der Renovierung helfe.",
  "2. Ich bitte dich darum, dass wir alle Homeoffice machen können.",
  "3. Ich habe mich schon daran gewöhnt, ob du an dem Kurs teilnehmen möchtest?",
  "4. Hast du darüber nachgedacht, dass ich später noch die Wäsche wasche?",
  "5. Meine Eltern verlassen sich darauf, dass er gestern früher gegangen ist.",
  "6. Er entschuldigt sich dafür, dass du mir beim Umzug hilfst.",
  "7. Erinnerst du mich bitte daran, dass mein Freund immer zu spät kommt.",

  // Часть 2
  "1. Wofür bist du dankbar? – Für das gute Wetter.",
  "2. Von wem redet sie jeden Tag? – Von ihrem neuen Freund.",
  "3. Worüber ärgert sie sich? – Über ihr instabiles Internet.",
  "4. Woran hast du Interesse? – An einem Tutorial für Videokonferenzen.",
  "5. Mit wem hat sie heute in der Pause diskutiert? – Mit dem Hausmeister.",
  "6. Auf wen passt du heute auf? – Auf die Kinder von meiner Schwester.",
  "7. Mit wem telefonierst du? – Mit meiner Mutter."
];

// Правильный текст для проверки (без пробелов в начале/конце)
const correctText = exerciseText.join("\n").replace(/\s+/g, " ").trim();

// Разбиваем на символы и создаём spans
function init() {
  const container1 = document.getElementById("text1");
  const container2 = document.getElementById("text2");

  container1.innerHTML = "<p>1. Meine Chefin engagiert sich dafür, <span class='gap' data-index='0'>dass</span> ich ihnen bei der Renovierung helfe.</p>";
  container2.innerHTML = ""; // Добавим позже

  // Полный текст для spans
  const fullText = correctText;
  const textEl = document.createElement("div");
  textEl.style.display = "none";
  document.body.appendChild(textEl); // Временный для spans

  fullText.split("").forEach((char, i) => {
    const span = document.createElement("span");
    span.classList.add("char");
    span.textContent = char === " " ? "\u00A0" : char; // Не-breaking space
    span.dataset.index = i;
    textEl.appendChild(span);
  });

  // Показываем только видимые части
  container1.innerHTML = exerciseText.slice(0,7).join("<br><br>");
  container2.innerHTML = exerciseText.slice(7).join("<br><br>");
}

let currentIndex = 0;

function handleInput(e) {
  const input = e.target.value;
  const spans = document.querySelectorAll(".char"); // Все символы

  // Сбрасываем стили
  spans.forEach(s => {
    s.classList.remove("correct", "wrong", "current");
  });

  for (let i = 0; i < input.length; i++) {
    if (i >= spans.length) break;
    const expected = correctText[i];
    const typed = input[i];

    if (typed === expected) {
      spans[i].classList.add("correct");
    } else {
      spans[i].classList.add("wrong");
    }
    currentIndex = i + 1;
  }

  // Подсветка следующего
  if (currentIndex < spans.length) {
    spans[currentIndex].classList.add("current");
  }
}

// Запуск
init();
const inputEl = document.getElementById("input");
inputEl.addEventListener("input", handleInput);
inputEl.addEventListener("focus", handleInput);

window.addEventListener("load", () => {
  inputEl.focus();
});
</script>

</body>
</html>
